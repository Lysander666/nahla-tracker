   <!-- 
=== QUICK SYNC (MINIMAL) =========================================

1) SYNC GALACTIC BAND PHASE (1â€“12)
   setPhaseAnchor("YYYY-MM-DDTHH:MM:SS", PHASE);

2) SYNC REBEKAH RISE/SET
   setRebekahAnchor("YYYY-MM-DDTHH:MM:SS");

3) AFTER RUNNING:
   â€¢ Console prints new anchors:
       var CYCLE_ANCHOR  = new Date("...");
       var REBEKAH_ANCHOR = new Date("...");
   â€¢ Paste into GitHub (replace old ones)
   â€¢ Commit â†’ synced

=== END ===========================================================
-->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Nahla Tracker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Nahla Tracker">
    <meta property="og:description" content="Live day/night tracker and gallery for Nahla, a remote Elite Dangerous moon.">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Nahla Tracker">
    <meta name="twitter:description" content="Live day/night tracker and gallery for Nahla, a remote Elite Dangerous moon.">

<link rel="icon" type="image/png" sizes="16x16" href="faviconmain16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon32@2x.png">
<link rel="icon" type="image/png" sizes="128x128" href="faviconmain128.png">
<link rel="manifest" href="manifest.json">





<link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png?v=2">

<link rel="apple-touch-icon" sizes="180x180" href="favicon-512.png?v=2">
    
    <style>
        body { 
            background-color: #1a1a1a; 
            color: #e0e0e0; 
            font-family: monospace; 
            font-size: 1.1rem; 
            line-height: 1.6; 
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding-top: 40px;   /* try 20â€“40px */

        }

.header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    text-align: center;
}

.header-logo {
    padding-top: 20px;      /* space above the logo */
    padding-bottom: 20px;   /* space between logo and tracker title */
    text-align: center;     /* keeps logo centered */
}


.header-logo img {
    width: 68px;
    height: 68px;
}

.header-title {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.header-tagline {
    text-align: center;
    font-size: 1rem;
    margin-top: -60px;
    margin-bottom: 22px;
    color: #61dafb;
    font-family: Consolas, "Courier New", monospace;
    text-shadow: 0 0 8px rgba(97,218,251,0.4);
}



.title-main {
    font-size: 2rem;
    font-weight: 600;
}

.title-sub {
    font-size: 1.2rem;
    opacity: 0.85;
}

       



        
        h2 {
            text-align: center;
        }
        
#tracker {
    padding: 20px;
    border: 1px solid #444;
    border-radius: 8px;
    margin-bottom: 25px;
    text-align: center;
    background-color: #222222;
   /* box-shadow: inset 0 0 40px rgba(0,0,0,0.6); */


}

        #moonclock {
            font-family: "Consolas", "Courier New", monospace;
            font-size: 1.2rem;
            color: #3af2ff;
            text-shadow: 0 0 8px #3af2ff, 0 0 14px #007a85;
            text-align: center;
            margin-top: 8px;
            letter-spacing: 2px;
        }

        #moonclock-coordinated {
            font-family: "Consolas", "Courier New", monospace;
            font-size: 1.2rem;
            color: #ff61c7;
            text-shadow: 0 0 8px #ff61c7, 0 0 14px #852c66;
            text-align: center;
            margin-top: 4px;
            letter-spacing: 2px;
        }

        .time-highlight {
          color: #61dafb;
          font-weight: bold;
        }

      .phase-highlight {
       color: #3af2ff;
       text-shadow: 0 0 1px #3af2ff, 0 0 2px #007a85;
      }

       
/* Rebekah static sky compass */

.rebekah-compass {
    margin-top: 45px;   /* adjust this number as you like */
    margin-bottom: 4px; /* keeps spacing above the label clean */
    display: flex;
    justify-content: center;
}

.rebekah-compass-circle {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: 1px solid #444;
    position: relative;
    box-shadow: 0 0 14px rgba(97, 218, 251, 0.2);
    background: radial-gradient(circle at 50% 60%, #222 0%, #181818 60%, #141414 100%);
    font-size: 0.7rem;
    color: #888;
}

/* Cardinal points */

.rebekah-compass-circle .cardinal {
    position: absolute;
    font-size: 0.7rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.rebekah-compass-circle .cardinal.n { top: 4px; left: 50%; transform: translateX(-50%); }
.rebekah-compass-circle .cardinal.s { bottom: 4px; left: 50%; transform: translateX(-50%); }
.rebekah-compass-circle .cardinal.e { right: 6px; top: 50%; transform: translateY(-50%); }
.rebekah-compass-circle .cardinal.w { left: 8px; top: 50%; transform: translateY(-50%); }

/* Rebekah marker â€“ fixed position in southern sky */

.rebekah-center {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: #e10000;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.8;
}

.rebekah-ray {
    position: absolute;
    width: 2px;
    height: 42px;
    background: linear-gradient(
        to bottom,
        rgba(255, 80, 120, 0.0),
        rgba(255, 80, 120, 0.7)
    );
    top: 50%;
    left: 50%;
    transform-origin: top center;
    transform: translateX(-50%) rotate(266deg);
}

.rebekah- {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #c72a4a; /* deep red */
    box-shadow: 0 0 12px rgba(255, 80, 120, 0.9),
                0 0 18px rgba(255, 40, 80, 0.5);
    
    transform-origin: top center;
    transform: translateX(-50%) rotate(266deg) translateY(42px);
   animation: rebekahPulse 2s ease-in-out infinite; /* Add this line */
}


.rebekah-::after {
    content: "";
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    border: 1px solid rgba(255, 130, 150, 0.5);
    transform: rotate(25deg); /* fake ring tilt */
    opacity: 0.4;
}

.rebekah-label-outside {
    margin-top: 30px;   /* increase or decrease to taste */
    text-align: center;
    font-size: 0.75rem;
    color: #9ee7ff;
    text-shadow: 0 0 5px rgba(97,218,251,0.7);
}





        #notes-box {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 0 12px rgba(97, 218, 251, 0.1);
        }

        #notes-box h2 {
            color: #61dafb;
            margin-top: 0;
            margin-bottom: 10px;
            font-family: "Consolas", "Courier New", monospace;
        }

        @media (max-width: 600px) {
          #notes-box, 
          #notes-box p, 
          #notes-box div, 
          #notes-box span {
            font-size: 0.85rem !important;
            line-height: 1.45;
          }
        }

        #notes {
            background-color: #121212;
            border: 1px solid #333;
            border-radius: 6px;
            color: #ccc;
            font-family: "Inter", sans-serif;
            font-size: 0.95rem;
            padding: 8px 10px;
            line-height: 1.5;
            text-align: justify;
        }

        .gallery-container {
          cursor: grab;
        }

        .gallery-container:active {
          cursor: grabbing;
        }

        .gallery-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            height: 40px;
        }

        .gallery-header h2 {
            color: #61dafb;
            margin: 0;
            text-align: center;
            position: relative;
            top: 8px; 
        }

        .gallery-btn {
            background: none;
            border: 2px solid #61dafb;
            color: #61dafb;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            flex-shrink: 0;
            padding: 0;           
            outline: none;        
            -webkit-appearance: none; 
            appearance: none;     
        }

        .gallery-btn:hover {
            background-color: #61dafb;
            color: #1a1a1a;
            transform: scale(1.1);
        }

        .gallery-btn:active {
            transform: scale(0.95);
        }
        
        #system-info-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        
        .celestial-body, #map-panel, #manifest-panel {
            flex: 1;
            min-width: 250px;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 0 20px 20px 20px;
            background-color: #222;
            height: 635px; /* <<<<< ALL PANEL HEIGHTS ARE CONTROLLED BY THIS LINE HERE!! <<<<<< */
            overflow-y: auto;
        }
        
        .celestial-body h3, #map-panel h3, #manifest-panel h3 {
            color: #61dafb;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            position: sticky;
            top: 0;
            background-color: #222;
            margin: 0;
            padding-top: 20px;
            z-index: 1;
        }
        
        .celestial-body ul, #map-panel ul {
            list-style-type: none;
            padding-left: 0;
            font-size: 0.9rem;
            color: #ccc;
        }
        .celestial-body li, #map-panel li {
            margin-bottom: 8px;
        }
        .celestial-body li strong, #map-panel li strong {
            color: #bbb;
        }

        #map-panel h4 {
            margin-bottom: 10px;
            color: #bbb;
        }
        
        .celestial-body::-webkit-scrollbar,
        #map-panel::-webkit-scrollbar
            width: 10px;
        }
        
        .celestial-body::-webkit-scrollbar-track,
        #map-panel::-webkit-scrollbar-track
            background: #1a1a1a;
            border-radius: 4px;
        }
        
        .celestial-body::-webkit-scrollbar-thumb,
        #map-panel::-webkit-scrollbar-thumb
            background: #444;
            border-radius: 4px;
        }
        
        .celestial-body::-webkit-scrollbar-thumb:hover,
        #map-panel::-webkit-scrollbar-thumb:hover
            background: #555;
        }
    
        #hope-info {
            padding-bottom: 18px !important;
            min-height: 460px;
            justify-content: flex-start !important;
        }
        
        .manifest-list {
            list-style-type: none;
            padding-left: 0;
            font-size: 0.85rem;
        }
        .manifest-list li {
            margin-bottom: 5px;
            color: #aaa;
        }
        .manifest-list strong {
            color: #ddd;
            min-width: 40px;
            display: inline-block;
        }
        .manifest-list ul {
            list-style-type: square;
            color: #888;
            padding-left: 20px;
            margin-top: 5px;
        }

/* --- MANIFEST PANEL SPECIFIC SCROLLBAR --- */

#manifest-panel {
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: #444 #222; 
}

#manifest-panel::-webkit-scrollbar {
    width: 4px; /* Thin width for Chrome/Safari */
    display: block; /* Force it to show */
}

#manifest-panel::-webkit-scrollbar-track {
    background: #222;
}

#manifest-panel::-webkit-scrollbar-thumb {
    background-color: #444; 
    border-radius: 4px;
}
       

 
        .hl-landable { color: #8f9; }
        .hl-terraform { color: #61dafb; font-weight: bold; }
        .hl-earthlike { color: #61fbb0; font-weight: bold; text-transform: uppercase; }
        .hl-life { color: #fbd061; font-weight: bold; }

        #gallery-section {
            margin-top: 30px;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            background-color: #2a2a2a;
        }
        
        #gallery-section h2 {
            color: #61dafb;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .gallery-container {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
            height: 250px;
            scroll-behavior: smooth;
        }
        
        .gallery-container::-webkit-scrollbar {
            height: 10px;
        }
        
        .gallery-container::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 4px;
        }
        
        .gallery-container::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        .gallery-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .gallery-item {
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            width: 300px;
            height: 220px;
            border: 2px solid #444;
            border-radius: 8px;
            overflow: visible;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
        }

        .gallery-item img {
            width: 100%;
            height: calc(100% - 36px);
            object-fit: cover;
            background-color: #333;
        }

        .gallery-caption {
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #222;
            color: #ccc;
            font-size: 0.85rem;
        }
        
        #map-panel img {
            width: 100%;
            max-width: 275px;
            margin-top: 55px;
            margin-left: auto;
            margin-right: auto;
            display: block;
            border-radius: 6px;
            box-shadow: 0 0 18px rgba(97, 218, 251, 0.18);
        }
        
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .lightbox.active {
            display: flex;
        }
        
        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(97, 218, 251, 0.3);
        }
        
        .lightbox-close {
            position: absolute;
            top: 30px;
            right: 40px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .lightbox-close:hover {
            color: #61dafb;
        }
            
        .gallery-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.95);
            color: #ddd;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s ease-out;
            margin-bottom: 6px;
            z-index: 50;
        }

        .gallery-item:hover .gallery-tooltip {
            opacity: 1;
        }

.celestial-body::-webkit-scrollbar,
        #map-panel::-webkit-scrollbar,
        .gallery-container::-webkit-scrollbar {
            display: none;
        }

        .celestial-body,
        #map-panel,
        .gallery-container {
            scrollbar-width: none;
        }

        .audio-btn {
            background: none;
            border: none;
            color: #61dafb;
            font-size: 18px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            padding: 0;
            vertical-align: 0px;
        }

        .audio-btn:active {
            transform: scale(0.9);
        }

        a {
            text-decoration: none;
            color: #66e2ff;
        }

        #nahla-clock-container {
            width: 100%;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #nahla-clock {
            width: 100%;
            height: auto;
            max-width: 260px;
            filter: drop-shadow(0 0 15px rgba(97, 218, 251, 0.4));
        }

        .clock-face {
            fill: #1a1a1a;
            stroke: #333;
            stroke-width: 2;
        }

        .clock-ring {
            fill: none;
            stroke: #61dafb;
            stroke-width: 2.4;
            opacity: 0.6;
        }

        .clock-axis {
            stroke: rgba(97, 218, 251, 0.25);
            stroke-width: 1;
            stroke-dasharray: 3, 3;
        }


        .sector {
            fill: rgba(97, 218, 251, 0.06);
            stroke: rgba(97, 218, 251, 0.10);
            stroke-width: 1;
        }

        .sector:nth-child(odd) {
            fill: rgba(97, 218, 251, 0.04);
        }

        .tick {
            stroke: #3c9fb9;
            stroke-width: 1.6;
            stroke-linecap: round;
        }

        .tick.major {
            stroke: #61dafb;
            stroke-width: 2.0;
        }

        .clock-number {
            fill: #61dafb;
            font-size: 10px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: central;
            opacity: 0.9;
        }

        .center- {
            fill: #61dafb;
        }

        .hand-hour {
            stroke: #61dafb;
            stroke-width: 2.8;
            stroke-linecap: round;
            transform-origin: center;
            opacity: 0.75;
        }

        .hand-glow {
            stroke: rgba(97, 218, 251, 0.4);
            stroke-width: 4;
            stroke-linecap: round;
            filter: blur(1px);
            transform-origin: center;
        }

        .clock-label {
            margin-top: 6px;
            font-size: 0.8rem;
            letter-spacing: 0.08em;
            text-transform: none;
            color: #9ee7ff;
        }

        .active-phase {
            stroke: #9ee7ff !important;
            stroke-width: 2 !important;
            animation: phasePulse 2s ease-in-out infinite;
        }

        @keyframes phasePulse {
            0%   { fill-opacity: 0.06; stroke-opacity: 0.4; }
            50%  { fill-opacity: 0.12; stroke-opacity: 1.0; }
            100% { fill-opacity: 0.06; stroke-opacity: 0.4; }
        }

       @keyframes rebekahPulse {
    0%, 100% { 
        box-shadow: 0 0 12px rgba(255, 80, 120, 0.9),
                    0 0 18px rgba(255, 40, 80, 0.5);
        transform: translateX(-50%) rotate(266deg) translateY(42px) scale(1);
    }
    50% { 
        box-shadow: 0 0 20px rgba(255, 80, 120, 1),
                    0 0 30px rgba(255, 40, 80, 0.8),
                    0 0 40px rgba(255, 40, 80, 0.4);
        transform: translateX(-50%) rotate(266deg) translateY(42px) scale(1.15);
    }
}

       .live-highlight {
       color: #8ffaff; /* slightly brighter cyan */
       text-shadow: 0 0 4px rgba(90, 240, 255, 0.8);
       font-weight: 500; /* barely stronger */
      }

       /* ===========================
   WEATHER PANEL
=========================== */
.weather-panel {
    margin: 22px 0 12px 0;
    
    /* CHANGE THIS LINE: 
       Old: padding: 12px 16px;
       New: Adds 35px to the top, 20px to the bottom for balance 
    */
    padding: 35px 16px 20px 16px;

    background: #111;
    border: 1px solid #222;
    border-radius: 10px;

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.weather-wave {
    width: 100%;             /* Allow it to fill the panel width */
    display: flex;           /* Turn on Flexbox */
    justify-content: center; /* Force the SVG to the center */
    margin-bottom: 12px;
    margin-top: 30px;
}

.weather-temp-readout {
    text-align: center;
    font-size: 1rem; /* Reduced from 1.1rem (default) */
    color: #bbb;       /* Optional: slightly dimmer color looks nice */
    margin-top: 5px;   /* Optional: adds a tiny bit of space from the wave */
}




        /* ===========================
   NAHLA DRIFT PANEL (END)
   =========================== */

#drift-panel {
    margin-top: 30px;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 20px;
    background-color: #222;
    box-shadow: 0 0 18px rgba(0, 0, 0, 0.5);
    font-size: 0.95rem;
}

#drift-panel h2 {
    color: #61dafb;
    margin-top: 0;
    margin-bottom: 12px;
    font-family: "Consolas", "Courier New", monospace;
    text-align: left;
}

.drift-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #444;
    margin-bottom: 14px;
}

.drift-header-title {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.drift-pill {
    display: inline-block;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #9ee7ff;
    padding: 3px 7px;
    border-radius: 999px;
    border: 1px solid rgba(97, 218, 251, 0.4);
    background: rgba(20, 40, 50, 0.9);
}

.drift-title-main {
    font-size: 1.15rem;
    font-weight: 600;
}

.drift-clock-box {
    display: flex;
    align-items: center;
    gap: 14px;
    background-color: #1b1b1b;
    padding: 10px 14px;
    border-radius: 10px;
    border: 1px solid #333;
}

.drift-clock {
    text-align: center;
    min-width: 110px;
}

.drift-clock-label {
    font-size: 0.7rem;
    color: #888;
    margin-bottom: 2px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
}

.drift-clock-value {
    font-size: 1.2rem;
    font-family: "Consolas", "Courier New", monospace;
}

.drift-clock-nlt {
    color: #61dafb;
    text-shadow: 0 0 5px rgba(97, 218, 251, 0.7);
}

.drift-clock-divider {
    width: 1px;
    height: 28px;
    background-color: #444;
}

.drift-explainer {
    background-color: #1c1c1c;
    border-left: 4px solid #61dafb;
    padding: 10px 12px;
    margin-bottom: 14px;
    color: #ccc;
    line-height: 1.5;
}

.drift-explainer p {
    margin: 0;
}

.drift-highlight {
    color: #61dafb;
    font-weight: 600;
}

.drift-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.85rem;
    color: #aaa;
}

.drift-controls-right {
    display: flex;
    align-items: center;
    gap: 6px;
}

#drift-rows-select {
    background-color: #222;
    border: 1px solid #444;
    color: #eee;
    border-radius: 4px;
    padding: 3px 6px;
    font-size: 0.85rem;
    font-family: inherit;
}

#drift-rows-select:focus {
    outline: none;
    border-color: #61dafb;
}

/* Table layout */

.drift-table {
    border: 1px solid #333;
    border-radius: 6px;
    overflow: hidden;
    background-color: #181818;
}

.drift-table-header {
    display: grid;
    grid-template-columns: 0.6fr 1.4fr 1.1fr 3fr;
    gap: 10px;
    padding: 8px 10px;
    background-color: #111;
    border-bottom: 1px solid #333;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #888;
}

.drift-table-header-shift {
    text-align: left;
}

.drift-table-body {
    max-height: 340px;
    overflow-y: auto;
}

.drift-row {
    display: grid;
    grid-template-columns: 0.6fr 1.4fr 1.1fr 3fr;
    gap: 10px;
    padding: 7px 10px;
    align-items: center;
    font-size: 0.85rem;
    border-bottom: 1px solid #222;
    transition: background-color 0.15s ease;
}

.drift-row:last-child {
    border-bottom: none;
}

.drift-row:hover {
    background-color: #242424;
}

.drift-row-current {
    background-color: #1e2a33;
    border-left: 3px solid #61dafb;
}

.drift-cell.drift-cycle {
    color: #777;
    font-weight: 600;
}

.drift-row-current .drift-cell.drift-cycle {
    color: #fff;
}

.drift-cell.drift-date {
    color: #ccc;
    display: flex;
    align-items: center;
    gap: 6px;
}

.drift-cell.drift-time {
    font-family: "Consolas", "Courier New", monospace;
    font-size: 0.95rem;
}

.drift-bar-cell {
    font-size: 0.75rem;
}

/* Drift bar */

.drift-bar-track {
    position: relative;
    width: 100%;
    height: 6px;
    border-radius: 999px;
    background-color: #101010;
    overflow: hidden;
    margin-bottom: 3px;
}

.drift-bar-hour-marker {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 1px;
    background-color: #333;
}

.drift-bar-marker {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 6px;
    border-radius: 999px;
    background-color: #61dafb;
    box-shadow: 0 0 8px rgba(97, 218, 251, 0.9);
    transform: translateX(-50%);
}

.drift-bar-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.68rem;
    color: #555;
    font-family: "Consolas", "Courier New", monospace;
}

.drift-footer {
    margin-top: 10px;
    font-size: 0.7rem;
    color: #777;
    text-align: center;
}

/* Responsive tweak */

@media (max-width: 800px) {
    .drift-table-header,
    .drift-row {
        grid-template-columns: 0.7fr 1.3fr 1.2fr 2.6fr;
    }

    .drift-header {
        align-items: flex-start;
    }

    .drift-clock-box {
        width: 100%;
        justify-content: space-between;
    }
}

       /* Drift Panel Scrollbar â€” Nahla dark theme */

#drift-table-body::-webkit-scrollbar {
    width: 8px;
}

#drift-table-body::-webkit-scrollbar-track {
    background: #181818; /* very dark grey, like other panels */
}

#drift-table-body::-webkit-scrollbar-thumb {
    background: #333;    /* dark thumb */
    border-radius: 4px;
}

#drift-table-body::-webkit-scrollbar-thumb:hover {
    background: #444;    /* slight brighten on hover */
}

/* Firefox */
#drift-table-body {
    scrollbar-width: thin;
    scrollbar-color: #333 #181818;
}


/* Only for screens around your laptop size */
@media (min-width: 1200px) and (max-width: 1400px) {
    #system-info-container {
        zoom: 0.8;
    }
}

       /* Pulse animation for the weather dot */
#temp-wave-dot {
    transform-origin: center;
    transform-box: fill-box; /* Ensures it scales from its own center */
    animation: tempDotPulse 2s infinite ease-in-out;
}      

@keyframes tempDotPulse {
    0% {
        transform: scale(1);
        fill-opacity: 1;
        filter: drop-shadow(0 0 2px rgba(58, 242, 255, 0.5));
    }
    50% {
        transform: scale(1.5); /* Grows 50% larger */
        fill-opacity: 0.8;
        filter: drop-shadow(0 0 8px rgba(58, 242, 255, 1)); /* Bright glow */
    }
    100% {
        transform: scale(1);
        fill-opacity: 1;
        filter: drop-shadow(0 0 2px rgba(58, 242, 255, 0.5));
    }
}

/* This ensures the SVG shrinks to fit the phone screen without breaking coordinates */
#temp-wave {
    width: 100%;
    height: auto;
    max-width: 800px;
}       
       

    </style>
</head>
<body>
<div class="header">
    <div class="header-logo">
        <img src="favicon8.png" alt="Nahla Tracker Logo">
    </div>
    <div class="header-title">
        <div class="title-main">Nahla Tracker</div>
        <div class="title-sub">LIVE â€¢ v0.9 (beta)</div>
    </div>
</div>

<div class="header-tagline"><i></i>A random moon; a deliberate study.</i></div>   

        <div id="tracker">
            <div id="status">Loading...</div>
            <div id="hope">...</div>
            <div id="band">...</div>
            <div id="rebekah">...</div>
            <div id="moonclock">...</div>
            <div id="moonclock-coordinated">...</div>
         <!--  <div id="next-phase-timer" style="margin-top: 6px; color:#6eb5c0; font-family: monospace; font-size:1rem;">
             Next phase in: --      
            </div>   -->


            <div style="font-size: 0.9rem; color: #aaa; margin-top: 15px;">
                <a href="https://inara.cz/elite/cmdr/440263/" 
                    style="color: inherit; text-decoration: none;" 
                    target="_blank" 
                    rel="noopener noreferrer">
                    Living and studying on a remote moon since July 2025. By CMDR Lysander666 on Inara.
                </a>
            </div>
        </div>

        <h2>System Information</h2>

        <div id="system-info-container">
            
            <div class="celestial-body" id="nahla-info">
                <h3>Nahla (Moon)</h3>
                <ul>
                    <li><strong>Type:</strong> Rocky Sulphur Moon</li>
                    <li><strong>Mass:</strong> 0.0458 Earths</li>
                    <li><strong>Radius: 2,469 km</strong></li>
                    <li><strong>Atmosphere:</strong> None</li>
                    <li><strong>Gravity:</strong> 0.31 G</li>
                    <li><strong>Temp:</strong> 143 K - 275 K / -127C - 2C (Observed)</li>
                    <li><strong>Volcanism:</strong> Metallic magma, gas vents, fumaroles</li>
                    <li><strong>Orbital Period:</strong> 1.1 Earth days</li>
                    <li><strong>Rotation:</strong> 1.1 Earth days (Tidally Locked)</li>
                    <li><strong>Observation post:</strong> Miley (Mandalay) at Natalja's Pass (39.2, 104.3)</li>
                    <li>
                        <strong>Nahla ambience audio:</strong>
                        <button id="audio-btn" class="audio-btn">â–¶</button>
                        <audio id="nahla-audio" src="nahla-ambience.mp3"></audio>
                    </li>
                </ul>
            </div>

            <div class="celestial-body" id="rebekah-info">
                <h3>Rebekah (Parent)</h3>
                <ul>
                    <li><strong>Type:</strong> Class IV Gas Giant, ringed</li>
                    <li><strong>Mass:</strong> 3202.37 Earths</li>
                    <li><strong>Radius:</strong> 66,809 km</li>
                    <li><strong>Gravity:</strong> 29.19 G</li>
                    <li><strong>Temp:</strong> 908 K / 635C</li>
                    <li><strong>Atmosphere:</strong> H<sub>2</sub> (72.89%), He (27.11%)</li>
                    <li><strong>Distance from Primary:</strong> 3k ls</li>
                    <li><strong>Orbital Period:</strong> 555.2 d</li>
                    <li><strong>Rotation:</strong> 0.4 Earth days</li>
                </ul>

<div class="rebekah-compass">
    <div class="rebekah-compass-circle">
        <div class="cardinal n">N</div>
        <div class="cardinal e">E</div>
        <div class="cardinal s">S</div>
        <div class="cardinal w">W</div>

        <div class="rebekah-center"></div>
        <div class="rebekah-ray"></div>
        <div class="rebekah-"></div>
    </div>
</div>

<div class="rebekah-label-outside">Bearing from Natalja's Pass</div>


            </div>

            <div class="celestial-body" id="hope-info">
                <h3>Hope (Primary Star)</h3>
                <ul>
                    <li><strong>Type:</strong> A5 Vb Blue-White Star</li>
                    <li><strong>Mass:</strong> 1.6758 Solar</li>
                    <li><strong>Radius:</strong> 1.427 Solar</li>
                    <li><strong>Temp:</strong> 8,631 K / 8,358 C</li>
                    <li><strong>Absolute magnitude:</strong> 2.3165 </li>
                    <li><strong>Age:</strong> 800 million years</li>
                    <li><strong>Rotation:</strong> 1.0 Earth days</li>

                    <div id="nahla-clock-container">
                        <svg id="nahla-clock" viewBox="0 0 200 200">
                            <circle cx="100" cy="100" r="90" class="clock-face" />
                            <circle cx="100" cy="100" r="88" class="clock-ring" />

                            <!-- Quadrant axis lines -->
                            <line class="clock-axis" x1="100" y1="12" x2="100" y2="188" />
                            <line class="clock-axis" x1="12" y1="100" x2="188" y2="100" />

                            <g id="nahla-sectors"></g>
                            <g id="nahla-ticks"></g>
                            <g id="nahla-numbers"></g>

                            <line id="nahla-hand-glow" class="hand-glow"
                                  x1="100" y1="100" x2="100" y2="56" />

                            <line id="nahla-hand-hour" class="hand-hour"
                                  x1="100" y1="100" x2="100" y2="56" />

                            <circle cx="100" cy="100" r="3" class="center-" />
                        </svg>

                        <div class="clock-label">Nahla Phase Clock â€¢ 25h Day</div>
                        <div class="clock-label">Galactic Band = &#945;-&#956; â€¢ <span class="live-highlight">Live</span></div>
                    </div>
                </ul>
            </div>

            <div id="map-panel">
                <h3>Hypi Bra EV-P d5-78</h3>
                <ul>
                    <li><strong>Dist. to Sol:</strong> 43,895.24 ly</li>
                    <li><strong>Dist. to Colonia:</strong> 22,698.70 ly</li>
                </ul>
                <h4>Galactic Position</h4>
                <img src="galaxy_map.png" alt="Galactic Position" onclick="openLightbox('galaxy_map.png')" style="cursor: pointer;">
            </div>

            <div id="manifest-panel">
                <h3>Full System Manifest</h3>
                <ul class="manifest-list">
                   <li><strong>A</strong> Blue-White Star (Hope) (Scoopable)</li>
                    <li><strong>A Belt</strong> Rocky Belt (Bellatrix)</li>
                    <li><strong>1</strong> Metal-rich body (Simone) (3,835 K)</li>
                    <li><strong>2</strong> Class III gas giant (Marika)
                        <ul>
                            <li><strong>2a</strong>Rocky body (Abelina) <span class="hl-landable">(L)</span></li>
                            <li><strong>2b</strong>Rocky body (Jana) <span class="hl-landable">(L)</span></li>
                            <li><strong>2c</strong>Rocky body (Mira) <span class="hl-landable">(L)</span></li>
                            <li><strong>2d</strong>Rocky body (Maria) <span class="hl-landable">(L)</span>
                                <ul><li><strong>2da</strong>Rocky body (Theresa) <span class="hl-landable">(L)</span></li></ul>
                            </li>
                            <li><strong>2e</strong>Rocky body (Bunika) <span class="hl-landable">(L)</span></li>
                        </ul>
                    </li>
                    <li><strong>3</strong>High metal content (RuÅ¾ena) (1,077 K)</li>
                    <li><strong>4</strong>Y (Brown dwarf) Star (Rayne)
                        <ul>
                            <li><strong>4a</strong>Rocky body (Ferril) <span class="hl-landable">(L)</span></li>
                        </ul>
                    </li>
                    <li><strong>5</strong><span class="hl-terraform">High metal content (BÃ¡thory) (Terraform Candidate)</span></li>
                    <li><strong>6</strong>Class IV gas giant (Rebekah)
                        <ul>
                            <li><strong>6a</strong>Rocky body <span class="hl-landable">(L / Nahla)</span></li>
                            <li><strong>6b</strong>Icy body (Elena) </li>
                        </ul>
                    </li>
                    <li><strong>7</strong><span class="hl-life">Gas giant with water-based life (Aeoga)</span>
                        <ul>
                            <li><strong>7a</strong>Rocky body (Herbst9) <span class="hl-landable">(L)</span></li>
                            <li><strong>7b</strong>Rocky body (Asmorod) <span class="hl-landable">(L)</span></li>
                            <li><strong>7c</strong>Rocky body (Troum) <span class="hl-landable">(L)</span></li>
                        </ul>
                    </li>
                    <li><strong>8</strong><span class="hl-earthlike">*** Earth-like world *** (SkaÃ°i) </span></li>
                    <li><strong>9</strong>Class IV gas giant (Draupadi)
                        <ul>
                            <li><strong>9a</strong>Rocky body (Sarasvati) <span class="hl-landable">(L)</span></li>
                            <li><strong>9b</strong>Rocky body (Gauri) <span class="hl-landable">(L)</span></li>
                            <li><strong>9c</strong>Rocky body (Chaumunda) <span class="hl-landable">(L)</span></li>
                            <li><strong>9d</strong>Rocky body (Rati) <span class="hl-landable">(L)</span>
                                <ul><li><strong>9da</strong>Rocky body (Kali) <span class="hl-landable">(L)</span></li></ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>10</strong>High metal content (Sita)</li>
                    <li><strong>11</strong>High metal content (Ariana)</li>
                    <li><strong>12</strong>High metal content (Anneke)</li>
                </ul>
            </div>
            
        </div>

   <!-- ====================== -->
<!--   NAHLA WEATHER PANEL  -->
<!-- ====================== -->
<div class="weather-wave">
    <svg id="temp-wave" width="800" height="80" viewBox="0 0 800 80">
        <defs>
            <linearGradient id="wave-gradient" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="rgba(58, 242, 255, 0.25)" />
                <stop offset="100%" stop-color="rgba(58, 242, 255, 0)" />
            </linearGradient>
        </defs>

        <polygon id="temp-wave-fill" points="" fill="url(#wave-gradient)"></polygon>

        <polyline id="temp-wave-line" points="" 
                  stroke="#3af2ff" fill="none" stroke-width="2"
                  style="filter: drop-shadow(0 0 6px rgba(58, 242, 255, 0.6));">
        </polyline>

        <circle id="temp-wave-dot" r="4" fill="#3af2ff"></circle>
    </svg>
</div>

    <div class="weather-temp-readout">
        <span class="weather-label">Current temperature at Natalja's Pass:</span>
        <span id="weather-temp" class="weather-value">--</span>
    </div>
</div>
   

        <div id="gallery-section">
            <div class="gallery-header">
                <button class="gallery-btn" id="scroll-left">&lt;</button>
                <h2>Gallery</h2>
                <button class="gallery-btn" id="scroll-right">&gt;</button>
            </div>
            <div class="gallery-container">
                <div class="gallery-item" onclick="openLightbox('Nahla.jpg')">
                    <div class="gallery-tooltip">Nahla</div>
                    <img src="Nahla.jpg" alt="Nahla">
                    <div class="gallery-caption">Nahla</div>
                </div>             

                <div class="gallery-item" onclick="openLightbox('Rebekah-from-Nahla.jpg')">
                    <div class="gallery-tooltip">Rebekah seen from Nahla</div>
                    <img src="Rebekah-from-Nahla.jpg" alt="Rebekah seen from Nahla">
                    <div class="gallery-caption">Rebekah seen from Nahla</div>
                </div>
                         
                <div class="gallery-item" onclick="openLightbox('Pate-Sablee-Overhead.jpg')">
                    <div class="gallery-tooltip">PÃ¢te SablÃ©e crater</div>
                    <img src="Pate-Sablee-Overhead.jpg" alt="PÃ¢te SablÃ©e crater">
                    <div class="gallery-caption">PÃ¢te SablÃ©e crater</div>
                </div>     

                <div class="gallery-item" onclick="openLightbox('galactic-band.jpg')">
                    <div class="gallery-tooltip">Galactic band</div>
                    <img src="galactic-band.jpg" alt="Galactic band">
                    <div class="gallery-caption">Galactic band</div>
                </div>
                    
                <div class="gallery-item" onclick="openLightbox('Natalja.jpg')">
                    <div class="gallery-tooltip">Natalja's Pass</div>
                    <img src="Natalja.jpg" alt="Natalja's Pass">
                    <div class="gallery-caption">Natalja's Pass</div>
                </div>

                <div class="gallery-item" onclick="openLightbox('night.jpg')">
                    <div class="gallery-tooltip">True Night</div>
                    <img src="night.jpg" alt="Night">
                    <div class="gallery-caption">True Night</div>
                </div>

                <div class="gallery-item" onclick="openLightbox('galacticnight.jpg')">
                    <div class="gallery-tooltip">Galactic Night</div>
                    <img src="galacticnight.jpg" alt="Galactic Night">
                    <div class="gallery-caption">Galactic Night</div>
                </div>         
                    
                <div class="gallery-item" onclick="openLightbox('hope.jpg')">
                    <div class="gallery-tooltip">Hope</div>
                    <img src="hope.jpg" alt="Hope">
                    <div class="gallery-caption">Hope</div>
                </div>     

                <div class="gallery-item" onclick="openLightbox('sunset.jpg')">
                    <div class="gallery-tooltip">Sunset</div>
                    <img src="sunset.jpg" alt="Hope">
                    <div class="gallery-caption">Sunset</div>
                </div>
            </div>
        </div>

        <div class="lightbox" id="lightbox" onclick="closeLightbox()">
            <span class="lightbox-close">&times;</span>
            <img id="lightbox-image" src="" alt="Enlarged view">
        </div>

        <div id="notes-box">
            <h2>ðŸŒ• Nahla News Network ðŸŒŒ</h2>
            <div id="notes"><p><strong>25/11/3311: Live drift chart added:</strong> This shows GMT offset to NLT.
                <p><strong>24/11/3311: Massive update to the tracker:</strong> Lots of updates over the weekend to our tracker - most notably being the Phase Clock which shows live galactic band phase times, of which there are 12. Phase numbers have been changed to
                    Greek letters for clarity to avoid them getting confused with hours! Overall time sync also has been massively improved. For the foreseable future we will focus on our ground research
                    here on Nahla and update the tracker/remove minor bugs sporadically ^^ </p>
                <p><strong>21/11/3311: New calibrations and visitations!:</strong> Thanks to <a class="cyan-link" href="https://bsky.app/profile/fool.canonn.tech" target="_blank">LCU</a> we have the exact length of Nahla's 
                    rotation, which is 25 hours, 26 mins [and ten seconds!]. And yesterday Hope system received a rare visit from a Sidewinder. Welcome!</p>
                <p><strong>20/11/3311: Four months today!:</strong> Today marks four months here for <strong>Zell Ak'inyi</strong>. That's a good amount of study, research, solace and relaxation for the Rawrunning pioneer. 
                    Keep up with her through <a class="cyan-link" href="https://distantworlds3.space/projects/rawrunner/" target="_blank">Distant Worlds 3</a> ðŸš€ </p>
                <p><strong>19/11/3311: Nahla Tracker is in alpha, v0.21:</strong> With this new version, NT is in alpha! We have ripped out all the old 'Keplerian' tracker script
                    and rebuilt it around our 12 galactic phase system. This relies on regular observation [i.e. every few days to prevent drift]. Any public release
                    will be a while but we're getting there slowly!</p>
                <p><em>Clarification:</em> Nahla Coordinated time [NCT] isn't truly 24 Earth hours. It's a compressed version of Nahla's 26h 24m solar day, scaled for reference and context. 
                    Every NCT 'second' lasts roughly 1.1 Earth seconds. Here we live by GMT. </p>
                <br>
                Dayâ€”night cycles beyond Earth vary according to the orbital and rotational dynamics of their respective worlds, rather than adhering to Earth's 24-hour rhythm.
                <p></p>
                <small>Nahla Tracker is a personal project of Lysander666 - <a class="cyan-link" href="https://bsky.app/profile/lysander666.bsky.social" target="_blank">@lysander666.bsky.social</a></small>
            </div>
        </div>
 <div id="drift-panel">
            <h2>Nahla Drift Chart</h2>

            <div class="drift-header">
                <div class="drift-header-title">
                    <div class="drift-pill">GMT vs Nahla Local Time</div>
                    <div class="drift-title-main">Nahla Midnight Drift</div>
                </div>

                <div class="drift-clock-box">
                    <div class="drift-clock">
                        <div class="drift-clock-label">GMT / UTC</div>
                        <div class="drift-clock-value" id="drift-gmt-clock">--:--:--</div>
                    </div>
                    <div class="drift-clock-divider"></div>
                    <div class="drift-clock">
                        <div class="drift-clock-label">Nahla Local Time (NLT)</div>
                        <div class="drift-clock-value drift-clock-nlt" id="drift-nlt-clock">--:--:--</div>
                    </div>
                </div>
            </div>

            <div class="drift-explainer">
                <p>
                    <strong>The Drift:</strong> A solar day on Nahla lasts <span class="drift-highlight">25h 26m 10s</span>, 
                    which is <span class="drift-highlight">1h 26m 10s longer</span> than an Earth day.
                    This means <strong>NLT midnight (00:00)</strong> slides later in GMT each cycle.
                    The chart below shows when NLT 00:00 happens in GMT over upcoming Nahla days.
                </p>
            </div>

            <div class="drift-controls">
                <div class="drift-controls-label">Upcoming Nahla cycles</div>
                <div class="drift-controls-right">
                    <span>Show rows:</span>
                    <select id="drift-rows-select">
                        <option value="7" selected>7</option>
                        <option value="14">14</option>
                        <option value="30">30</option>
                        <option value="60">60</option>
                    </select>
                </div>
            </div>

            <div class="drift-table">
                <div class="drift-table-header">
                    <div>Cycle</div>
                    <div>GMT Date</div>
                    <div>NLT 00:00 @</div>
                    <div class="drift-table-header-shift">Daily Shift</div>
                </div>
                <div id="drift-table-body" class="drift-table-body">
                    <!-- rows injected by JS -->
                </div>
            </div>

            <div class="drift-footer" id="drift-anchor-info">
                <!-- anchor info injected by JS -->
            </div>
        </div>
   
    </div> 
    
    <script>
// =======================
//  NAHLA 12-PHASE TRACKER
// =======================

const MOON_NAME = "Nahla";

const SUNRISE_PHASE_INDEX0 = 0;
const SUNSET_PHASE_INDEX0  = 8;
const NIGHT_START_INDEX0   = 9;

const DAY_LENGTH_HOURS   = 25.435;
const DAY_LENGTH_SECONDS = 91570;

const PHASE_COUNT           = 12;
const PHASE_LENGTH_SECONDS  = DAY_LENGTH_SECONDS / PHASE_COUNT;

var CYCLE_ANCHOR   = new Date("2025-11-22T11:46:55.000Z");
var REBEKAH_ANCHOR = new Date("2025-11-23T14:00:00.000Z");

// Utility function
function mod(a, b) {
    return ((a % b) + b) % b;
}

// Make mod() globally accessible for the clock
window.mod = mod;

// Load anchors from shared storage on startup
async function loadAnchorsFromStorage() {
    try {
        const cycleResult = await window.storage.get('nahla-cycle-anchor', true);
        const rebekahResult = await window.storage.get('nahla-rebekah-anchor', true);
        
        if (cycleResult && cycleResult.value) {
            CYCLE_ANCHOR = new Date(cycleResult.value);
            console.log('%c[LOADED] Cycle anchor from storage: ' + CYCLE_ANCHOR.toISOString(), 'color: lime;');
        }
        if (rebekahResult && rebekahResult.value) {
            REBEKAH_ANCHOR = new Date(rebekahResult.value);
            console.log('%c[LOADED] Rebekah anchor from storage: ' + REBEKAH_ANCHOR.toISOString(), 'color: lime;');
        }
    } catch (error) {
        console.log('%c[STORAGE] Using default anchors (no saved data found)', 'color: yellow;');
    }
}

// Save anchors to shared storage
async function saveAnchorsToStorage() {
    try {
        await window.storage.set('nahla-cycle-anchor', CYCLE_ANCHOR.toISOString(), true);
        await window.storage.set('nahla-rebekah-anchor', REBEKAH_ANCHOR.toISOString(), true);
        console.log('%c[SAVED] Anchors saved to shared storage', 'color: lime; font-weight: bold;');
    } catch (error) {
        console.error('[STORAGE ERROR]', error);
    }
}

function format_timedelta(total_seconds) {
    total_seconds = Math.max(0, total_seconds);

    const hours   = Math.floor(total_seconds / 3600);
    const minutes = Math.floor((total_seconds % 3600) / 60);
    const seconds = Math.floor(total_seconds % 60);

    return (
        String(hours).padStart(2, "0")   + ":" +
        String(minutes).padStart(2, "0") + ":" +
        String(seconds).padStart(2, "0")
    );
}    

function greekPhase(n) {
    return ["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼"][n-1];
}

// Sync helpers
function setPhaseAnchor(observedTimestampString, observedPhaseNumber) {
    const observedTime = new Date(observedTimestampString);

    if (isNaN(observedTime.getTime())) {
        console.error("Invalid timestamp passed to setPhaseAnchor()");
        return;
    }

    if (observedPhaseNumber < 1 || observedPhaseNumber > 12) {
        console.error("Phase number must be between 1 and 12");
        return;
    }

    const offsetSeconds = (observedPhaseNumber - 1) * PHASE_LENGTH_SECONDS;
    const correctedAnchorMs = observedTime.getTime() - offsetSeconds * 1000;

    window.CYCLE_ANCHOR = new Date(correctedAnchorMs);

    console.log(
        `%c[SYNC] Galactic Band Anchor Updated\n` +
        `Observed Phase: ${observedPhaseNumber}\n` +
        `Observed Time: ${observedTime.toISOString()}\n` +
        `New CYCLE_ANCHOR: ${window.CYCLE_ANCHOR.toISOString()}`,
        "color: cyan; font-weight: bold;"
    );

    printCodeForGitHub();
}

function setRebekahAnchor(observedTimestampString) {
    const observedTime = new Date(observedTimestampString);

    if (isNaN(observedTime.getTime())) {
        console.error("Invalid timestamp passed to setRebekahAnchor()");
        return;
    }

    window.REBEKAH_ANCHOR = observedTime;

    console.log(
        `%c[SYNC] Rebekah Anchor Updated\n` +
        `Observed Rise/Transit: ${observedTime.toISOString()}\n` +
        `New REBEKAH_ANCHOR set.`,
        "color: violet; font-weight: bold;"
    );

    printCodeForGitHub();
}

function printAnchors() {
    console.log(
        `%cCurrent Anchors:\n` +
        `CYCLE_ANCHOR:   ${window.CYCLE_ANCHOR.toISOString()}\n` +
        `REBEKAH_ANCHOR: ${window.REBEKAH_ANCHOR.toISOString()}`,
        "color: orange; font-weight: bold;"
    );
}

const BAND_PHASE_DESCRIPTIONS = {
    1: "sun rising (left)",
    2: "steep rising",
    3: "mid-height vertical",
    4: "high, slanting across",
    5: "overhead horizontal (maximum elevation)",
    6: "high, descending",
    7: "mid-height vertical (reversed)",
    8: "steeply descending (right)",
    9: "low, angled sunset (right)",
    10:"low, flat dusk (reversed)",
    11:"deep night",
    12:"galactic dawn, dim rise"
};

function get_phase_label(phaseNumber) {
    return `Phase ${phaseNumber}: ${BAND_PHASE_DESCRIPTIONS[phaseNumber]}`;
}

function get_cycle_state(now) {
    const elapsed_seconds = (now - CYCLE_ANCHOR) / 1000;
    const wrapped         = mod(elapsed_seconds, DAY_LENGTH_SECONDS);

    const phaseIndex0     = Math.floor(wrapped / PHASE_LENGTH_SECONDS);
    const phaseNumber     = phaseIndex0 + 1;
    const secondsIntoPhase = wrapped - phaseIndex0 * PHASE_LENGTH_SECONDS;
    const hoursIntoDay     = wrapped / 3600;

    return {
        wrappedSeconds: wrapped,
        phaseIndex0,
        phaseNumber,
        secondsIntoPhase,
        hoursIntoDay
    };
}

       // ===============================
//  SUN & HOPE ELEVATION HELPERS
// ===============================

// Sun elevation (deg) from wrapped seconds in a 25h26m10s solar day.
function getSunElevationDeg(wrappedSeconds) {
    const angle = (wrappedSeconds / DAY_LENGTH_SECONDS) * 2 * Math.PI;
    return Math.sin(angle) * 90; // -90Â° (nadir) â†’ +90Â° (zenith)
}

// Hope elevation based on phaseIndex0 (12-phase cycle)
function getHopeElevationDeg(phaseIndex0) {
    // Divide 12 phases into a sinusoid from -90Â° to +90Â°.
    const angle = (phaseIndex0 / 12) * 2 * Math.PI;
    return Math.sin(angle) * 90;
}


function get_sun_state_index(phaseIndex0) {
    return Math.floor(phaseIndex0 / 2);
}

function get_hope_indicator(phaseIndex0) {
    const sunState = get_sun_state_index(phaseIndex0);

    if (sunState <= 3) {
        const symbols = ["ðŸŒ…","â˜€ï¸","ðŸ”†","ðŸŒ„"];
        const arc = ["â”€","â”€","â”€","â”€","â”€","â”€"];
        arc[sunState] = symbols[sunState];
        return `<strong>Hope:</strong> [${arc.join("")}]`;
    }

    return "<strong>Hope:</strong> [â”€â”€â”€â”€â”€â”€â”€â”€] (below horizon)";
}

function get_galactic_band_indicator(phaseNumber) {
    const phaseLabel = `<span class="phase-highlight">Phase ${greekPhase(phaseNumber)}</span>`;

    if (phaseNumber === 5) {
        return `<strong>Galactic Band:</strong> ðŸŒŒ ${phaseLabel} â€“ âœ¨PEAK BRIGHTNESS (${BAND_PHASE_DESCRIPTIONS[phaseNumber]})`;
    } else if (phaseNumber === 4 || phaseNumber === 6) {
        return `<strong>Galactic Band:</strong> ðŸŒŒ ${phaseLabel} â€“ BRIGHT (${BAND_PHASE_DESCRIPTIONS[phaseNumber]})`;
    } else if (phaseNumber === 3 || phaseNumber === 7 || phaseNumber === 8 || phaseNumber === 9) {
        return `<strong>Galactic Band:</strong> ðŸŒŒ ${phaseLabel} â€“ visible (${BAND_PHASE_DESCRIPTIONS[phaseNumber]})`;
    } else {
        return `<strong>Galactic Band:</strong> ðŸŒŒ ${phaseLabel} â€“ visible (low angle â€“ ${BAND_PHASE_DESCRIPTIONS[phaseNumber]})`;
    }
}


function get_rebekah_status(now) {
    const elapsed = (now - REBEKAH_ANCHOR) / 1000;
    const wrapped = mod(elapsed, DAY_LENGTH_SECONDS);
    const half    = DAY_LENGTH_SECONDS / 2;

    if (wrapped < half) {
        const time_until_set = half - wrapped;
        return `<strong>Rebekah:</strong> ðŸª VISIBLE | Est. set in: <span class="time-highlight">${format_timedelta(time_until_set)}</span> (ESTIMATE)`;
    } else {
        const time_until_rise = DAY_LENGTH_SECONDS - wrapped;
        return `<strong>Rebekah:</strong> â”€ below horizon | Est. rise in: <span class="time-highlight">${format_timedelta(time_until_rise)}</span> (ESTIMATE)`;
    }
}

function get_nahla_local_time_string(wrappedSeconds) {
    const hours   = Math.floor(wrappedSeconds / 3600);
    const minutes = Math.floor((wrappedSeconds % 3600) / 60);
    const seconds = Math.floor(wrappedSeconds % 60);

    const fractional = wrappedSeconds - Math.floor(wrappedSeconds);
    const ms2        = Math.floor(fractional * 100);

    return (
        "Nahla Local Time: " +
        String(hours).padStart(2,"0")   + ":" +
        String(minutes).padStart(2,"0") + ":" +
        String(seconds).padStart(2,"0") + "." +
        String(ms2).padStart(2,"0") +
        " (out of 25:26:10)"
    );
}

function get_nahla_coordinated_time_string(wrappedSeconds) {
     const SCALE = 24 / DAY_LENGTH_HOURS;  // Auto-sync to actual Nahla day length
    const scaled_seconds = wrappedSeconds * SCALE;

    const hours   = Math.floor(scaled_seconds / 3600);
    const minutes = Math.floor((scaled_seconds % 3600) / 60);
    const seconds = Math.floor(scaled_seconds % 60);

    const fractional = scaled_seconds - Math.floor(scaled_seconds);
    const ms2        = Math.floor(fractional * 100);

    return (
        "Nahla Coordinated Time: " +
        String(hours).padStart(2,"0")   + ":" +
        String(minutes).padStart(2,"0") + ":" +
        String(seconds).padStart(2,"0") + "." +
        String(ms2).padStart(2,"0") +
        " (out of 24:00:00)"
    );
}

function get_time_to_next_phase(secondsIntoPhase) {
    const remaining = PHASE_LENGTH_SECONDS - secondsIntoPhase;
    return format_timedelta(remaining);
}

function getNahlaTempKelvin(wrappedSeconds) {
    const minK = 143;
    const maxK = 275;

    // Normalised 0 â†’ 1 day model using sin curve
    const angle = (wrappedSeconds / DAY_LENGTH_SECONDS) * 2 * Math.PI;
    const norm = (Math.sin(angle - Math.PI / 2) + 1) / 2; 
    // Shifted so minimum is at â€œnightâ€, maximum at â€œdayâ€

    const K = minK + (maxK - minK) * norm;

    return `${K.toFixed(0)} K (${(K - 273.15).toFixed(1)} Â°C)`;
}
       
       

function printCodeForGitHub() {
    const cycle = window.CYCLE_ANCHOR.toISOString();
    const rebekah = window.REBEKAH_ANCHOR.toISOString();

    console.log(`
////////////////////////////////////////////////////
//  COPY THIS BLOCK INTO YOUR GITHUB CODE
////////////////////////////////////////////////////

var CYCLE_ANCHOR   = new Date("${cycle}");
var REBEKAH_ANCHOR = new Date("${rebekah}");

////////////////////////////////////////////////////
//  END OF ANCHOR BLOCK
////////////////////////////////////////////////////
`);
}

function updateDisplay() {
    const now = new Date();
    const cycle = get_cycle_state(now);

    const phaseIndex0   = cycle.phaseIndex0;
    const phaseNumber   = cycle.phaseNumber;
    const wrapped       = cycle.wrappedSeconds;
    const hoursIntoDay  = cycle.hoursIntoDay;

    const isDay = phaseIndex0 >= SUNRISE_PHASE_INDEX0 && phaseIndex0 < SUNSET_PHASE_INDEX0;

    let statusText;
    let timeToEvent;

    if (isDay) {
        const sunset_at = SUNSET_PHASE_INDEX0 * PHASE_LENGTH_SECONDS;
        timeToEvent     = sunset_at - wrapped;
        statusText = `â˜€ï¸  DAY on ${MOON_NAME} | Sunset in: <span class="time-highlight">${format_timedelta(timeToEvent)}</span> | <span class="time-highlight">${hoursIntoDay.toFixed(2)}h</span> into solar day`;
    } else {
        const sunrise_at = 12 * PHASE_LENGTH_SECONDS;
        const timeToEvent = sunrise_at - wrapped;
        statusText = `ðŸŒ™ NIGHT on ${MOON_NAME} | Sunrise in: <span class="time-highlight">${format_timedelta(timeToEvent)}</span> | <span class="time-highlight">${hoursIntoDay.toFixed(2)}h</span> into solar day`;
    }

    const hopeHtml = get_hope_indicator(phaseIndex0);

    const bandIndicator = get_galactic_band_indicator(phaseNumber);
    const bandHtml = bandIndicator;

    const rebekahHtml = get_rebekah_status(now);

    const moonclockString  = get_nahla_local_time_string(wrapped);
    const nctString        = get_nahla_coordinated_time_string(wrapped);

   const nextPhaseString = "Next phase in: " + 
    get_time_to_next_phase(cycle.secondsIntoPhase);


    const statusEl  = document.getElementById("status");
    const hopeEl    = document.getElementById("hope");
    const bandEl    = document.getElementById("band");
    const rebekahEl = document.getElementById("rebekah");
    const moonEl    = document.getElementById("moonclock");
    const nctEl     = document.getElementById("moonclock-coordinated");
    const nextPhaseEl = document.getElementById("next-phase-timer");


    if (statusEl)  statusEl.innerHTML  = statusText;
    if (hopeEl)    hopeEl.innerHTML    = hopeHtml;
    if (bandEl)    bandEl.innerHTML    = bandHtml;
    if (rebekahEl) rebekahEl.innerHTML = rebekahHtml;
    if (moonEl)    moonEl.textContent  = moonclockString;
    if (nctEl)     nctEl.textContent   = nctString;
    if (nextPhaseEl) nextPhaseEl.textContent = nextPhaseString;
}



function updateTempDot(wrappedSeconds) {
    const dot = document.getElementById("temp-wave-dot");
    const svg = document.getElementById("temp-wave");
    if (!dot || !svg) return;

    // FIX: Use the internal SVG dimensions (500x60), NOT the screen size
    const waveWidth = 800; 
    const waveHeight = 80; 

    // The rest of the math remains exactly the same...
    const t = wrappedSeconds / DAY_LENGTH_SECONDS;
    const angle = t * 2 * Math.PI;
    const norm = (Math.sin(angle - Math.PI / 2) + 1) / 2;

    const dotX = t * waveWidth;
    const dotY = waveHeight - (norm * (waveHeight - 10)) - 5;

    dot.setAttribute("cx", dotX);
    dot.setAttribute("cy", dotY);
}


       
// Gallery Lightbox Functions
function openLightbox(imageSrc) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    lightboxImage.src = imageSrc;
    lightbox.classList.add('active');
}

function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('active');
}

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeLightbox();
    }
});

// Gallery draggable
const gallery = document.querySelector('.gallery-container');

let isDown = false;
let startX;
let scrollLeft;

gallery.addEventListener('mousedown', (e) => {
    isDown = true;
    gallery.classList.add('active');
    startX = e.pageX - gallery.offsetLeft;
    scrollLeft = gallery.scrollLeft;
});

gallery.addEventListener('mouseleave', () => {
    isDown = false;
});

gallery.addEventListener('mouseup', () => {
    isDown = false;
});

gallery.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - gallery.offsetLeft;
    const walk = (x - startX) * 1.3;
    gallery.scrollLeft = scrollLeft - walk;
});

const scrollLeftBtn = document.getElementById('scroll-left');
const scrollRightBtn = document.getElementById('scroll-right');

const scrollAmount = 630;

scrollLeftBtn.addEventListener('click', () => {
    gallery.scrollBy({
        left: -scrollAmount,
        behavior: 'smooth'
    });
});

scrollRightBtn.addEventListener('click', () => {
    gallery.scrollBy({
        left: scrollAmount,
        behavior: 'smooth'
    });
});

const audio = document.getElementById("nahla-audio");
const btn = document.getElementById("audio-btn");

btn.addEventListener("click", () => {
    if (audio.paused) {
        audio.play().catch(e => console.log("Audio play failed (likely missing file):", e));
        btn.textContent = "â¸";
    } else {
        audio.pause();
        btn.textContent = "â–¶";
    }
});

/* ===================================
  NAHLA CLOCK (SYNCED + ACTIVE)
=================================== */

(function() {

    const HOURS_ON_FACE = 25;
    const RADIUS = 88;
    const NUMBER_RADIUS = 72;
    const TICK_LENGTH_MAJOR = 10;
    const TICK_LENGTH_MINOR = 6;

    const greekPhases = ['Î±','Î²','Î³','Î´','Îµ','Î¶','Î·','Î¸','Î¹','Îº','Î»','Î¼'];

    const svgSectors = document.getElementById("nahla-sectors");
    const svgTicks   = document.getElementById("nahla-ticks");
    const svgNums    = document.getElementById("nahla-numbers");
    const handHour   = document.getElementById("nahla-hand-hour");
    const handGlow   = document.getElementById("nahla-hand-glow");

    function buildSectors() {
        const cx = 100, cy = 100;
        const r = 88;
        const labelR = 55;

        for (let i = 0; i < 12; i++) {
            const start = (i / 12) * 2*Math.PI - Math.PI/2;
            const end   = ((i+1)/12) * 2*Math.PI - Math.PI/2;
            const mid   = (start + end) / 2;

            const x1 = cx + r*Math.cos(start);
            const y1 = cy + r*Math.sin(start);
            const x2 = cx + r*Math.cos(end);
            const y2 = cy + r*Math.sin(end);

            const path = document.createElementNS("http://www.w3.org/2000/svg","path");
            path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`);
            path.setAttribute("class","sector");
            svgSectors.appendChild(path);

            const lx = cx + labelR*Math.cos(mid);
            const ly = cy + labelR*Math.sin(mid);

            const t = document.createElementNS("http://www.w3.org/2000/svg","text");
            t.textContent = greekPhases[i];
            t.setAttribute("x", lx);
            t.setAttribute("y", ly);
            t.setAttribute("fill", "#8eeaff");
            t.setAttribute("font-size", "14");
            t.setAttribute("font-family", "Consolas, monospace");
            t.setAttribute("text-anchor", "middle");
            t.setAttribute("dominant-baseline", "middle");
            t.setAttribute("opacity", "0.5");
            svgSectors.appendChild(t);
        }
    }

    function buildTicks() {
        for (let i = 0; i < HOURS_ON_FACE; i++) {
            const angleDeg = (i * 360) / HOURS_ON_FACE;
            const isMajor = i % 5 === 0;
            const length  = isMajor ? TICK_LENGTH_MAJOR : TICK_LENGTH_MINOR;

            const tick = document.createElementNS("http://www.w3.org/2000/svg","line");
            tick.setAttribute("x1",100);
            tick.setAttribute("y1",100 - RADIUS);
            tick.setAttribute("x2",100);
            tick.setAttribute("y2",100 - RADIUS + length);
            tick.setAttribute("class", `tick ${isMajor ? 'major':''}`);
            tick.setAttribute("transform",`rotate(${angleDeg},100,100)`);
            svgTicks.appendChild(tick);

            const angleRad = (angleDeg - 90)*(Math.PI/180);
            const tx = 100 + NUMBER_RADIUS*Math.cos(angleRad);
            const ty = 100 + NUMBER_RADIUS*Math.sin(angleRad);

            const num = document.createElementNS("http://www.w3.org/2000/svg","text");
            num.setAttribute("x", tx);
            num.setAttribute("y", ty);
            num.setAttribute("class","clock-number");
            num.textContent = i;
            svgNums.appendChild(num);
        }
    }

    function getWrappedNahlaSeconds() {
        const now = new Date();
        const anchor = (window.CYCLE_ANCHOR instanceof Date) ? window.CYCLE_ANCHOR : new Date(0);
        const elapsed = (now - anchor) / 1000;
        return window.mod(elapsed, DAY_LENGTH_SECONDS);
    }

    function getCurrentPhase(wrappedSec) {
        return Math.floor((wrappedSec / DAY_LENGTH_SECONDS) * 12) % 12;
    }

    let lastActive = null;

    function updateActiveSector(wrappedSec) {
        const phase = getCurrentPhase(wrappedSec);
        if (phase === lastActive) return;
        lastActive = phase;

        const paths = svgSectors.querySelectorAll("path");
        paths.forEach(p => p.classList.remove("active-phase"));
        if (paths[phase]) paths[phase].classList.add("active-phase");
    }

    function updateClock() {
        const wrapped = getWrappedNahlaSeconds();
        const fraction = wrapped / DAY_LENGTH_SECONDS;
        const rotation = fraction * 360;

        handHour.style.transform = `rotate(${rotation}deg)`;
        handGlow.style.transform = `rotate(${rotation}deg)`;

        updateActiveSector(wrapped);

        requestAnimationFrame(updateClock);
    }

    buildSectors();
    buildTicks();
    updateClock();

})();

// Initialize: Load anchors first, then start tracker
loadAnchorsFromStorage().then(() => {
    updateDisplay();
    updateWeatherPanel(); // Initialize weather panel
    setInterval(updateDisplay, 50);
    setInterval(updateWeatherPanel, 1000); // Update weather every second
}).catch(err => {
    console.error("Storage load failed, using defaults:", err);
    updateDisplay();
    updateWeatherPanel(); // Initialize weather panel
    setInterval(updateDisplay, 50);
    setInterval(updateWeatherPanel, 1000); // Update weather every second
});

   function toRad(deg) { return deg * Math.PI / 180; }
function getSunElevationDeg(wrappedSeconds) {
    // Simple solar elevation model:
    //  -90Â° = midnight
    //    0Â° = sunrise/sunset
    //   90Â° = high noon
    const fraction = wrappedSeconds / DAY_LENGTH_SECONDS;
    return Math.sin(fraction * 2 * Math.PI) * 90;
}

function getHopeElevationDeg(phaseIndex0) {
    // Placeholder model for Hope's elevation
    // Maps 0â€“11 phase index to -90Â° to +90Â°
    return (phaseIndex0 / 12) * 180 - 90;
}

       
function getSunElevationDegFromPhase(phaseIndex0) {
    const p = phaseIndex0 + 1; // convert 0â€“11 â†’ 1â€“12

    if (p === 5) return 60;                   // Îµ â€” overhead
    if (p === 4 || p === 6) return 40;        // Î´, Î¶ â€” high slanted
    if (p === 3 || p === 7) return 20;        // Î³, Î· â€” mid-height
    if (p === 2 || p === 8) return 5;         // Î², Î¸ â€” steep rising/descending (sunlight!)
    if (p === 1 || p === 9) return 1;         // Î±, Î¹ â€” sunrise/sunset
    if (p === 10 || p === 12) return -10;     // Îº dusk / Î¼ dawn
    return -30;                               // Î» deep night
}

       

function buildTemperatureWave() {
    const width = 800;
    const height = 80;
    const minK = 143;
    const maxK = 275;

    const points = [];
    for (let x = 0; x <= width; x++) {
        const t = x / width; 
        const angle = t * 2 * Math.PI;

        // Normalised sine wave
        const norm = (Math.sin(angle - Math.PI / 2) + 1) / 2;
        
        const y = height - (norm * (height - 10)) - 5;
        points.push(`${x},${y}`);
    }

    const linePointsString = points.join(" ");

    // 1. Draw the main line
    document.getElementById("temp-wave-line").setAttribute("points", linePointsString);

    // 2. Draw the fill area
    // We take the line, add a point at the Bottom-Right, then Bottom-Left to close the shape
    const fillPointsString = linePointsString + ` ${width},${height} 0,${height}`;
    
    const fillPoly = document.getElementById("temp-wave-fill");
    if (fillPoly) {
        fillPoly.setAttribute("points", fillPointsString);
    }
}

 
    

/* ======================================================
   NAHLA DRIFT TABLE v2 â€” GMT rollover, no flicker,
   restored hour labels, stable highlight.
   ====================================================== */

// Format GMT date (e.g. "26 Nov")
function formatUtcDateShort(d) {
    return d.toLocaleDateString("en-GB", {
        day: "2-digit",
        month: "short",
        timeZone: "UTC"
    }).replace(",", "");
}

// Compute real NLT midnight for a given GMT date
function computeNltMidnightForDate(dateObj) {
    const diffSeconds = (dateObj - CYCLE_ANCHOR) / 1000;
    const wrapped = mod(diffSeconds, DAY_LENGTH_SECONDS);
    const secondsUntilMidnight = DAY_LENGTH_SECONDS - wrapped;
    return new Date(dateObj.getTime() + secondsUntilMidnight * 1000);
}

// Compute cycle number
function computeCycleNumber(dateObj) {
    const nlt0 = computeNltMidnightForDate(dateObj);
    const diff = (nlt0 - CYCLE_ANCHOR) / 1000;
    return Math.floor(diff / DAY_LENGTH_SECONDS) + 1;
}

// Cache last GMT day to prevent flicker
let lastBuiltDay = null;

function buildDriftTable(force = false) {
    const now = new Date();

    // Today's GMT date at 00:00:00
    const today = new Date(Date.UTC(
        now.getUTCFullYear(),
        now.getUTCMonth(),
        now.getUTCDate()
    ));

    // Only rebuild ONCE per GMT day
    if (!force && lastBuiltDay === today.getTime()) return;
    lastBuiltDay = today.getTime();

    const body = document.getElementById("drift-table-body");
    body.innerHTML = "";

    const rowsToShow = parseInt(document.getElementById("drift-rows-select").value, 10);

    // First row = yesterday
    const firstDate = new Date(today);
    firstDate.setUTCDate(today.getUTCDate() - 1);

    for (let i = 0; i < rowsToShow; i++) {
        const d = new Date(firstDate);
        d.setUTCDate(firstDate.getUTCDate() + i);

        const nltMidnight = computeNltMidnightForDate(d);
        const cycle = computeCycleNumber(d);

        const row = document.createElement("div");
        row.className = "drift-row";

        // Cycle #
        const cycleCell = document.createElement("div");
        cycleCell.className = "drift-cell drift-cycle";
        cycleCell.textContent = `#${cycle}`;
        row.appendChild(cycleCell);

        // GMT Date
        const dateCell = document.createElement("div");
        dateCell.className = "drift-cell drift-date";
        dateCell.textContent = formatUtcDateShort(d);
        row.appendChild(dateCell);

        // NLT 00:00 time (HH:MM:SS)
        const timeCell = document.createElement("div");
        timeCell.className = "drift-cell drift-time";
        timeCell.textContent = nltMidnight.toISOString().split("T")[1].split(".")[0];
        row.appendChild(timeCell);

        // Bar cell
        const barCell = document.createElement("div");
        barCell.className = "drift-bar-cell";

        const barTrack = document.createElement("div");
        barTrack.className = "drift-bar-track";

        // Hour markers
        for (let h = 0; h < 24; h++) {
            const mk = document.createElement("div");
            mk.className = "drift-bar-hour-marker";
            mk.style.left = `${(h / 24) * 100}%`;
            barTrack.appendChild(mk);
        }

        // Midnight marker
        const seconds =
            nltMidnight.getUTCHours() * 3600 +
            nltMidnight.getUTCMinutes() * 60 +
            nltMidnight.getUTCSeconds();

        const pos = (seconds / 86400) * 100;

        const marker = document.createElement("div");
        marker.className = "drift-bar-marker";
        marker.style.left = `${pos}%`;
        barTrack.appendChild(marker);

        barCell.appendChild(barTrack);

        // Hour labels restored
        const labels = document.createElement("div");
        labels.className = "drift-bar-labels";

        ["00:00", "12:00", "23:59"].forEach(t => {
            const span = document.createElement("span");
            span.textContent = t;
            labels.appendChild(span);
        });

        barCell.appendChild(labels);
        row.appendChild(barCell);

        // Highlight today's row
        if (d.getTime() === today.getTime()) {
            row.classList.add("drift-row-current");
        }

        body.appendChild(row);
    }
}

// Update only clocks every second (no table rebuild)
function updateDriftPanelClocks() {
    const now = new Date();

    // GMT Clock
    document.getElementById("drift-gmt-clock").textContent =
        now.toISOString().split("T")[1].split(".")[0];

    const cycle = get_cycle_state(now);
    const wrapped = cycle.wrappedSeconds;

    const h = Math.floor(wrapped / 3600);
    const m = Math.floor((wrapped % 3600) / 60);
    const s = Math.floor(wrapped % 60);

    document.getElementById("drift-nlt-clock").textContent =
        `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

       function updateDriftAnchorInfo() {
    const footer = document.getElementById("drift-anchor-info");
    if (!footer) return;

    footer.textContent = `Cycle Anchor: ${CYCLE_ANCHOR.toISOString()} â€¢ Day Length: 25h 26m 10s`;
}

function updateWeatherPanel() {
    try {
        const now = new Date();
        // Check if cycle calculator exists before running
        if (typeof get_cycle_state !== "function") return;
        
        const cycle = get_cycle_state(now);

        // 1. Update the Text (Safely)
        const tempElement = document.getElementById("weather-temp");
        if (tempElement && typeof getNahlaTempKelvin === "function") {
            tempElement.textContent = getNahlaTempKelvin(cycle.wrappedSeconds);
        }

        // 2. Update the Dot Position (Safely)
        // We double check if updateTempDot exists to prevent crashes
        if (typeof updateTempDot === "function") {
            updateTempDot(cycle.wrappedSeconds);
        }

    } catch (err) {
        // If weather fails, log it but DO NOT crash the other trackers
        console.error("Weather Panel Error:", err);
    }
}



// Timer â€” stable, no-flicker
setInterval(() => {
    updateDriftPanelClocks();
    buildDriftTable(); // no rebuild unless GMT day changed
}, 1000);

// First build
buildDriftTable(true);
updateDriftPanelClocks();
updateDriftAnchorInfo();
buildTemperatureWave();
       


    </script>
</body>
</html>
