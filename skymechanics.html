<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nahla Sky Mechanics Simulator</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: "Courier New", monospace;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        h2 {
            color: #61dafb;
            text-shadow: 0 0 10px rgba(97, 218, 251, 0.3);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.5rem;
        }

        .canvas-container {
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            border: 2px solid #444;
            border-radius: 50%; /* Circular viewport */
            overflow: hidden;
            width: 400px;
            height: 400px;
            background: #0b0b0b;
        }

        canvas {
            display: block;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            background: #222;
            padding: 15px 25px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        button {
            background: transparent;
            border: 1px solid #61dafb;
            color: #61dafb;
            padding: 8px 16px;
            font-family: inherit;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            transition: all 0.2s;
        }

        button:hover {
            background: #61dafb;
            color: #1a1a1a;
        }

        .status-panel {
            margin-top: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: #888;
        }

        .legend {
            margin-top: 10px;
            display: flex;
            gap: 20px;
            font-size: 0.8rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        .line { width: 20px; height: 4px; display: inline-block; }
        
        .blue-bg { background-color: #3af2ff; box-shadow: 0 0 8px #3af2ff; }
    </style>
</head>
<body>

    <h2>Nahla Sky: The "Scoop & Flip" (Mirrored + Offset Fix)</h2>

    <div class="canvas-container">
        <canvas id="skyCanvas" width="400" height="400"></canvas>
    </div>

    <div class="status-panel">
        <div id="phase-display">PHASE: LOADING...</div>
        <div id="angle-display">ANGLE: 0°</div>
    </div>

    <div class="controls">
        <button id="btn-play">⏸ PAUSE</button>
        <button id="btn-reset">⏮ RESET</button>
    </div>

    <div class="legend">
        <div class="legend-item"><span class="line blue-bg"></span> Galactic Band</div>
        <div class="legend-item"><span class="dot blue-bg"></span> Hope (Sun)</div>
        <div class="legend-item" style="color: #555;">⬛ Horizon</div>
    </div>

    <script>
        const canvas = document.getElementById('skyCanvas');
        const ctx = canvas.getContext('2d');
        const btnPlay = document.getElementById('btn-play');
        const btnReset = document.getElementById('btn-reset');
        const phaseDisplay = document.getElementById('phase-display');
        const angleDisplay = document.getElementById('angle-display');

        const CX = canvas.width / 2;
        const CY = canvas.height / 2;
        
        // STARTING STATE (Based on Diagram 1)
        // Diagram 1 is Tilted / (approx -45 degrees relative to vertical)
        // We will map 0 to Vertical | (Diagram 3) for easier math, then offset.
        // Let's define simple "Progress": 0 = Start (Diag 1), 1 = End (Diag 9).
        
        let progress = 0; 
        let isRunning = true;
        let speed = 0.002; 

        function animate() {
            if (isRunning) {
                progress += speed;
                if (progress > 1) progress = 0; // Loop
            }
            
            draw();
            updateUI();
            requestAnimationFrame(animate);
        }

        function draw() {
            // 1. Clear
            ctx.fillStyle = '#0b0b0b'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Calculate State based on Progress (0 to 1)
            
            // ROTATION (CCW)
            // Start: ~45 deg (/) -> End: ~315 deg (\)
            // Let's map 0-1 to -135deg to +135deg for full arc
            const startAngle = -135 * (Math.PI / 180);
            const endAngle = 135 * (Math.PI / 180);
            const currentRotation = startAngle + (progress * (endAngle - startAngle));

            // VERTICAL "SCOOP" MOTION (Rising/Setting)
            // It should be low at start, high in middle, low at end.
            // Simple Sine wave
            const yOffset = Math.sin(progress * Math.PI) * -120; // -120 moves UP
            const currentY = CY + 80 + yOffset; // Start 80px below center

            ctx.save();
            
            // Move to position in sky
            ctx.translate(CX, currentY);

            // --- HORIZONTAL FLIP (MIRROR) ---
            // Because we mirror here, Positive X moves Left visually
            ctx.scale(-1, 1);
            
            // Rotate
            ctx.rotate(currentRotation);

            // --- DRAW OBJECTS ---

            // A. Galactic Band
            ctx.beginPath();
            ctx.strokeStyle = '#3af2ff';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#3af2ff';
            ctx.moveTo(-70, 0);
            ctx.lineTo(70, 0);
            ctx.stroke();

            // B. Hope (The Sun)
            // Fixed relative to band!
            // Based on Diagram 5 (Zenith), Hope is ABOVE the band.
            // CORRECTION: Swapped to -25 to move it the "other way"
            ctx.beginPath();
            ctx.fillStyle = '#3af2ff';
            ctx.shadowBlur = 25;
            ctx.shadowColor = '#ffffff';
            ctx.arc(-25, -40, 10, 0, Math.PI * 2); // -25px (Right side due to mirror), 40px Above
            ctx.fill();

            ctx.restore();

            // 3. Horizon Mask
            ctx.fillStyle = '#151515';
            ctx.fillRect(0, CY + 100, canvas.width, 200); // Ground
            
            ctx.beginPath();
            ctx.strokeStyle = '#61dafb';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 0;
            ctx.moveTo(0, CY + 100);
            ctx.lineTo(canvas.width, CY + 100);
            ctx.stroke();
        }

        function updateUI() {
            // Map progress to phases
            let phaseText = "";
            
            if (progress < 0.25) phaseText = "Phase 1: RISING (Scoop Up)";
            else if (progress < 0.75) phaseText = "Phase 2: ZENITH (The Flip)";
            else phaseText = "Phase 3: SETTING (Scoop Down)";

            phaseDisplay.textContent = phaseText;
            angleDisplay.textContent = `Progress: ${Math.round(progress * 100)}%`;
        }

        // Controls
        btnPlay.addEventListener('click', () => {
            isRunning = !isRunning;
            btnPlay.textContent = isRunning ? "⏸ PAUSE" : "▶ PLAY";
        });

        btnReset.addEventListener('click', () => {
            progress = 0;
            isRunning = true;
            btnPlay.textContent = "⏸ PAUSE";
        });

        // Start
        animate();

    </script>
</body>
</html>
